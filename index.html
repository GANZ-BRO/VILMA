<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matematika gyakorl√°s</title>
  <meta name="description" content="Matematika gyakorl√≥ alkalmaz√°s telefonra optimaliz√°lva, s√∂t√©t m√≥dban, nagy bet≈±kkel √©s k√∂z√©pre rendezett elrendez√©ssel.">
  <style>
    :root {
      --bg-dark: #121212;
      --text-dark: #f1f1f1;
      --input-bg-dark: #1e1e1e;
      --input-text-dark: #f1f1f1;
      --input-border-dark: #444;
      --bg-light: #f1f1f1;
      --text-light: #121212;
      --input-bg-light: #fff;
      --input-text-light: #121212;
      --input-border-light: #ccc;
      --primary: #3578e5;
      --primary-dark: #2851a3;
      --success: #4bb543;
      --danger: #e53935;
    }
    html { font-size: 20px; } /* nagyobb alap bet≈±m√©ret */
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-dark);
      color: var(--text-dark);
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    body.light {
      background: var(--bg-light);
      color: var(--text-light);
    }
    main {
      width: 100%;
      max-width: 430px;
      margin: 0 auto;
      padding: 1.2em 0.5em 2.5em 0.5em;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1em;
      margin-bottom: 0.3em;
    }
    h1 {
      font-size: 2em;
      margin: 0.25em 0 0.35em 0;
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.04em;
    }
    .settings {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.7em;
      align-items: center;
      margin-bottom: 1.1em;
    }
    .settings label, .settings select {
      font-size: 1.15em;
      font-weight: 500;
      width: 100%;
      text-align: center;
    }
    select {
      font-size: 1.18em;
      padding: 0.5em 0.7em;
      border-radius: 8px;
      border: 1.5px solid var(--input-border-dark);
      background: var(--input-bg-dark);
      color: var(--input-text-dark);
      margin-top: 0.2em;
      transition: background 0.3s, color 0.3s, border 0.3s;
      text-align: center;
    }
    body.light select {
      background: var(--input-bg-light);
      color: var(--input-text-light);
      border: 1.5px solid var(--input-border-light);
    }
    .game-stats {
      width: 100%;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1.2em;
      align-items: center;
      justify-content: center;
      margin-bottom: 1em;
    }
    .stat {
      font-weight: bold;
      font-size: 1.26em;
      letter-spacing: 0.04em;
    }
    .best {
      font-size: 1.05em;
      color: var(--success);
      margin-bottom: 0.2em;
      text-align: center;
    }
    #quiz > div {
      margin-bottom: 1.1em;
      border-radius: 12px;
      padding: 1.2em 0.4em;
      background: rgba(0,0,0,0.10);
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    body.light #quiz > div {
      background: rgba(0,0,0,0.03);
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.07);
    }
    label {
      font-size: 1.25em;
      display: block;
      margin-bottom: 0.7em;
      width: 100%;
      text-align: center;
    }
    .answer-view {
      width: 90%;
      font-size: 1.8em;
      padding: 0.5em 0.7em;
      border-radius: 9px;
      border: 2px solid var(--input-border-dark);
      background: var(--input-bg-dark);
      color: var(--input-text-dark);
      margin-bottom: 0.5em;
      letter-spacing: 0.08em;
      pointer-events: none;
      user-select: none;
      text-align: center;
      font-weight: 600;
    }
    body.light .answer-view {
      background: var(--input-bg-light);
      color: var(--input-text-light);
      border: 2px solid var(--input-border-light);
    }
    .big-btn, button {
      display: inline-block;
      font-size: 1.5em;
      padding: 0.9em 1.35em;
      border: none;
      border-radius: 12px;
      margin: 0.5em 0 0.5em 0;
      background: var(--primary);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.09);
      transition: background 0.22s, transform 0.08s;
      touch-action: manipulation;
      text-align: center;
    }
    button:hover, .big-btn:hover, button:focus, .big-btn:focus {
      background: var(--primary-dark);
      outline: none;
      transform: scale(1.04);
    }
    #theme-toggle {
      font-size: 2.1em;
      border-radius: 50%;
      width: 2.5em;
      height: 2.5em;
      padding: 0;
      background: none;
      color: inherit;
      box-shadow: none;
      border: 2px solid currentColor;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .numpad {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6em;
      margin: 0.7em auto 0.2em auto;
      justify-content: center;
      max-width: 300px;
    }
    .numpad-btn {
      width: 3.2em;
      height: 3.2em;
      font-size: 2em;
      border-radius: 0.5em;
      border: none;
      background: var(--input-bg-dark);
      color: var(--input-text-dark);
      border: 2px solid var(--input-border-dark);
      cursor: pointer;
      transition: background 0.25s, color 0.25s;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    body.light .numpad-btn {
      background: var(--input-bg-light);
      color: var(--input-text-light);
      border: 2px solid var(--input-border-light);
    }
    .numpad-btn:active, .numpad-btn:focus {
      background: var(--primary);
      color: #fff;
      outline: none;
    }
    @media (max-width: 600px) {
      html { font-size: 18px; }
      main { padding: 0.4em 0.1em 2.2em 0.1em; }
      h1 { font-size: 1.4em; }
      .big-btn, button { width: 100%; font-size: 1.13em; padding: 1.1em 0;}
      .answer-view { width: 100%; font-size: 1.22em;}
      .numpad { gap: 0.4em; }
      .numpad-btn { width: 3.1em; height: 3.1em; font-size: 1.45em;}
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>Matematika gyakorl√°s</h1>
      <button id="theme-toggle" aria-label="T√©ma v√°lt√°sa">üåó</button>
    </header>
    <div class="settings">
      <label for="category">Kateg√≥ria:
        <select id="category">
          <option value="√ñsszead√°s">√ñsszead√°s</option>
          <option value="Kivon√°s">Kivon√°s</option>
          <option value="Szorz√°s">Szorz√°s</option>
          <option value="Oszt√°s">Oszt√°s</option>
          <option value="Mind a n√©gy m≈±velet">Mind a n√©gy m≈±velet</option>
          <option value="Z√°r√≥jeles kifejez√©sek">Z√°r√≥jeles kifejez√©sek</option>
          <option value="T√∂rtek">T√∂rtek</option>
          <option value="Sz√°zal√©ksz√°m√≠t√°s">Sz√°zal√©ksz√°m√≠t√°s</option>
          <option value="Egyenletek √°trendez√©se">Egyenletek √°trendez√©se</option>
        </select>
      </label>
      <label for="difficulty">Neh√©zs√©gi szint:
        <select id="difficulty">
          <option value="easy">K√∂nny≈±</option>
          <option value="medium">K√∂zepes</option>
          <option value="hard">Neh√©z</option>
        </select>
      </label>
      <button class="big-btn" id="start-btn">J√°t√©k ind√≠t√°sa</button>
    </div>
    <div class="game-stats">
      <span class="stat" id="timer">‚è±Ô∏è Id≈ë: 0 mp</span>
      <span class="stat" id="score">üèÖ Pontsz√°m: 0</span>
    </div>
    <div class="best" id="best-stats" style="display:none;"></div>
    <section id="quiz" aria-label="Feladatsor"></section>
    <button class="big-btn" id="restart-btn" style="display:none;">√öjraj√°tsz√°s</button>
  </main>
  <script>
    // --- ALAPBE√ÅLL√çT√ÅSOK ---
    const QUESTIONS = 10;
    const DIFFICULTY_SETTINGS = {
      easy: { min: 0, max: 10 },
      medium: { min: -10, max: 20 },
      hard: { min: -50, max: 50 }
    };

    // --- HTML ELEMEK ---
    const quizContainer = document.getElementById("quiz");
    const timerDisplay = document.getElementById("timer");
    const scoreDisplay = document.getElementById("score");
    const bestStats = document.getElementById("best-stats");
    const difficultySelect = document.getElementById("difficulty");
    const categorySelect = document.getElementById("category");
    const startBtn = document.getElementById("start-btn");
    const restartBtn = document.getElementById("restart-btn");
    const themeToggle = document.getElementById("theme-toggle");

    // --- √ÅLLAPOTV√ÅLTOZ√ìK ---
    let score = 0, startTime = 0, timerInterval = null, currentQuestion = 0, questions = [];
    let best = { score: 0, time: null };
    let gameActive = false;

    // --- LEGJOBB EREDM√âNY MENT√âSE/BET√ñLT√âSE ---
    function loadBest() {
      const diff = difficultySelect.value;
      const cat = categorySelect.value;
      try {
        const bestRaw = localStorage.getItem("vilma-best-" + cat + "-" + diff);
        best = bestRaw ? JSON.parse(bestRaw) : { score: 0, time: null };
      } catch { best = { score: 0, time: null }; }
      showBest();
    }
    function saveBest(newScore, time) {
      const diff = difficultySelect.value;
      const cat = categorySelect.value;
      if (newScore > best.score || (newScore === best.score && (best.time === null || time < best.time))) {
        best = { score: newScore, time: time };
        localStorage.setItem("vilma-best-" + cat + "-" + diff, JSON.stringify(best));
        showBest();
      }
    }
    function showBest() {
      if (best.score > 0) {
        bestStats.innerHTML = `üèÜ <b>Legjobb eredm√©ny:</b> ${best.score} pont, ${best.time} mp (${categoryLabel()} / ${difficultyLabel()})`;
        bestStats.style.display = "";
      } else {
        bestStats.style.display = "none";
      }
    }
    function difficultyLabel() {
      switch(difficultySelect.value) {
        case "easy": return "K√∂nny≈±";
        case "medium": return "K√∂zepes";
        case "hard": return "Neh√©z";
        default: return "";
      }
    }
    function categoryLabel() {
      return categorySelect.options[categorySelect.selectedIndex].textContent;
    }

    // --- T√âMA V√ÅLT√ÅS ---
    function applyTheme() {
      // Csak darkb√≥l indul, vil√°gos csak kapcsol√°sra
      const dark = localStorage.getItem("vilma-theme");
      document.body.classList.toggle("light", dark === "light");
    }
    themeToggle.addEventListener("click", function() {
      const isLight = document.body.classList.contains("light");
      localStorage.setItem("vilma-theme", isLight ? "dark" : "light");
      applyTheme();
    });
    applyTheme();

    // --- NEH√âZS√âG √âS KATEG√ìRIA KEZEL√âSE ---
    difficultySelect.addEventListener("change", loadBest);
    categorySelect.addEventListener("change", loadBest);

    // --- ID≈êZ√çT≈ê ---
    function updateTimer() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      timerDisplay.textContent = `‚è±Ô∏è Id≈ë: ${elapsed} mp`;
    }

    // --- FELADATSOR GENER√ÅL√ÅSA ---
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }
    function simplifyFraction(num, denom) {
      let d = gcd(Math.abs(num), Math.abs(denom));
      return [num/d, denom/d];
    }
    function generateQuestions() {
      const { min, max } = DIFFICULTY_SETTINGS[difficultySelect.value];
      const category = categorySelect.value;
      questions = [];
      for (let i = 0; i < QUESTIONS; i++) {
        let q = {};
        switch (category) {
          case "√ñsszead√°s":
            {
              let num1 = getRandomInt(min, max), num2 = getRandomInt(min, max);
              q = { num1, num2, operator: "+", answer: num1 +*
ÓÄÄ

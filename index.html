<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Matematika gyakorl√°s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #181c25; color: #f7f7f7; margin: 0; }
    main { max-width: 480px; margin: auto; padding: 1em; }
    h1 { font-size: 1.4em; }
    select, button, input, .numpad-btn {
      font-size: 1.1em; padding: 0.4em 0.7em; border-radius: 7px;
      border: 1px solid #444; background: #232737; color: #fff;
    }
    .category-row, .settings-row { display: flex; flex-wrap: wrap; gap: 1em; align-items: center; margin-bottom: 1em;}
    .settings-row label { font-size: 1em; }
    .problem-card {
      background: #232737; border-radius: 8px; margin-bottom: 1em; padding: 0.7em;
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.09);
    }
    .problem-label { font-size: 1.06em; margin-bottom: 0.4em; display: block; }
    .answer-view {
      width: 60%; font-size: 1.15em; padding: 0.3em 0.7em;
      border-radius: 6px; border: 1px solid #444; background: #181c25; color: #fff; margin-bottom: 0.3em;
      letter-spacing: 0.05em; pointer-events: none; user-select: none; text-align: left;
    }
    .numpad { display: flex; flex-wrap: wrap; gap: 0.5em; margin-top: 0.5em; max-width: 230px; }
    .numpad-btn {
      width: 2.2em; height: 2.2em; font-size: 1.25em; border-radius: 0.5em;
      border: 1px solid #444; background: #232737; color: #fff; cursor: pointer;
      transition: background 0.18s, color 0.18s;
    }
    .numpad-btn:active, .numpad-btn:focus { background: #3578e5; color: #fff; outline: none; }
    .feedback { margin-top: 0.4em; font-weight: bold; font-size: 1em; }
    .feedback.correct { color: #79ec7d; }
    .feedback.wrong { color: #e53935; }
    .summary { background: #242a3e; border-radius: 8px; padding: 1em; margin-top: 1em;}
    .summary h2 { font-size: 1.13em; margin-top: 0; }
    .summary-list { margin:0.5em 0 0 0; padding:0; }
    .summary-list li { margin: 0.2em 0; }
    .best { color: #79ec7d; font-size: 0.98em; margin-top: 0.3em;}
    #start-btn, #restart-btn { margin-top: 1.1em; }
    @media (max-width:600px) {
      main { padding: 0.5em; }
      h1 { font-size: 1.1em; }
      .answer-view { width: 98%; }
      .numpad { gap: 0.3em; }
      .numpad-btn { width: 2.3em; height: 2.3em; font-size: 1.1em;}
    }
  </style>
</head>
<body>
  <main>
    <h1>Matematika gyakorl√°s</h1>
    <div class="category-row">
      <label for="category">Kateg√≥ria:</label>
      <select id="category">
        <option value="√ñsszead√°s">√ñsszead√°s</option>
        <option value="Kivon√°s">Kivon√°s</option>
        <option value="Szorz√°s">Szorz√°s</option>
        <option value="Oszt√°s">Oszt√°s</option>
        <option value="Mind a n√©gy m≈±velet">Mind a n√©gy m≈±velet</option>
        <option value="Z√°r√≥jeles kifejez√©sek">Z√°r√≥jeles kifejez√©sek</option>
        <option value="T√∂rtek">T√∂rtek</option>
        <option value="Sz√°zal√©ksz√°m√≠t√°s">Sz√°zal√©ksz√°m√≠t√°s</option>
        <option value="Egyenletek √°trendez√©se">Egyenletek √°trendez√©se</option>
      </select>
      <label for="difficulty">Neh√©zs√©g:</label>
      <select id="difficulty">
        <option value="easy">K√∂nny≈±</option>
        <option value="medium">K√∂zepes</option>
        <option value="hard">Neh√©z</option>
      </select>
      <input id="username" placeholder="Felhaszn√°l√≥n√©v" style="flex:1;max-width:160px;">
    </div>
    <div class="settings-row">
      <button id="start-btn">Gyakorl√°s ind√≠t√°sa</button>
      <button id="restart-btn" style="display:none;">√öjra</button>
      <span id="timer">‚è±Ô∏è 0 mp</span>
      <span id="score">üèÖ 0</span>
    </div>
    <div class="best" id="best-stats" style="display:none;"></div>
    <div id="problems"></div>
    <div id="summary"></div>
  </main>
  <script>
    // --- Helper functions for number/fraction/math ---
    function gcd(a, b) { while (b) [a, b] = [b, a % b]; return Math.abs(a); }
    function simplifyFraction(num, den) {
      const sign = (num * den) < 0 ? "-" : "";
      num = Math.abs(num); den = Math.abs(den);
      const d = gcd(num, den);
      return sign + (num/d) + "/" + (den/d);
    }
    function randInt(a, b) { return Math.floor(Math.random() * (b - a + 1)) + a; }
    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    // --- Problem generators by topic and difficulty ---
    function generateAddition(difficulty) {
      let range = {easy:[1,30], medium:[-20,60], hard:[-100,150]}[difficulty];
      return Array.from({length:10}, () => {
        let a = randInt(...range), b = randInt(...range);
        return { question:`${a} + ${b} = ?`, answer:a+b, explanation:`Az √∂sszead√°s eredm√©nye: ${a} + ${b} = ${a+b}` };
      });
    }
    function generateSubtraction(difficulty) {
      let range = {easy:[5,40], medium:[-30,70], hard:[-120,170]}[difficulty];
      return Array.from({length:10}, () => {
        let a = randInt(...range), b = randInt(...range);
        return { question:`${a} - ${b} = ?`, answer:a-b, explanation:`A kivon√°s eredm√©nye: ${a} - ${b} = ${a-b}` };
      });
    }
    function generateMultiplication(difficulty) {
      let range = {easy:[2,10], medium:[-10,15], hard:[-20,25]}[difficulty];
      return Array.from({length:10}, () => {
        let a = randInt(...range), b = randInt(...range);
        return { question:`${a} √ó ${b} = ?`, answer:a*b, explanation:`A szorz√°s eredm√©nye: ${a} √ó ${b} = ${a*b}` };
      });
    }
    function generateDivision(difficulty) {
      let range = {easy:[2,10], medium:[-10,15], hard:[-20,25]}[difficulty];
      return Array.from({length:10}, () => {
        let b = 0; while (b === 0) b = randInt(...range);
        let ans = randInt(-10, 15);
        let a = b * ans;
        return { question:`${a} √∑ ${b} = ?`, answer:ans, explanation:`${a} √∑ ${b} = ${ans}` };
      });
    }
    function generateMixed(difficulty) {
      const ops = ["+", "-", "√ó", "√∑"];
      let arr = [];
      let ranges = {
        "+": {easy:[1,30], medium:[-20,60], hard:[-100,150]},
        "-": {easy:[5,40], medium:[-30,70], hard:[-120,170]},
        "√ó": {easy:[2,10], medium:[-10,15], hard:[-20,25]},
        "√∑": {easy:[2,10], medium:[-10,15], hard:[-20,25]}
      };
      for (let i = 0; i < 10; i++) {
        let op = ops[randInt(0,3)];
        let a, b, ans, q, expl;
        if (op === "+") {
          a = randInt(...ranges["+"]. [difficulty]); b = randInt(...ranges["+"]. [difficulty]);
          ans = a + b; q = `${a} + ${b} = ?`; expl = `Az √∂sszead√°s eredm√©nye: ${a} + ${b} = ${ans}`;
        } else if (op === "-") {
          a = randInt(...ranges["-"]. [difficulty]); b = randInt(...ranges["-"]. [difficulty]);
          ans = a - b; q = `${a} - ${b} = ?`; expl = `A kivon√°s eredm√©nye: ${a} - ${b} = ${ans}`;
        } else if (op === "√ó") {
          a = randInt(...ranges["√ó"]. [difficulty]); b = randInt(...ranges["√ó"]. [difficulty]);
          ans = a * b; q = `${a} √ó ${b} = ?`; expl = `A szorz√°s eredm√©nye: ${a} √ó ${b} = ${ans}`;
        } else {
          b = 0; while (b === 0) b = randInt(...ranges["√∑"]. [difficulty]);
          ans = randInt(-10, 15); a = b * ans;
          q = `${a} √∑ ${b} = ?`; expl = `${a} √∑ ${b} = ${ans}`;
        }
        arr.push({question:q, answer:ans, explanation:expl});
      }
      return arr;
    }
    function generateParentheses(difficulty) {
      let arr = [];
      let r = {easy:[1,10], medium:[-10,20], hard:[-20,30]}[difficulty];
      for(let i=0;i<10;i++){
        let type = randInt(1,3);
        let a = randInt(...r), b = randInt(...r), c = randInt(-5,5);
        let q, ans, expl;
        if(type===1){
          q = `(${a} + ${b}) √ó ${c} = ?`; ans=(a+b)*c; expl=`El≈ësz√∂r z√°r√≥jel: ${a}+${b}=${a+b}, majd szorz√°s: ${a+b}√ó${c}=${ans}`;
        } else if(type===2){
          q = `(${a} - ${b}) + ${c} = ?`; ans=(a-b)+c; expl=`Z√°r√≥jel: ${a}-${b}=${a-b}, majd √∂sszead√°s: ${a-b}+${c}=${ans}`;
        } else {
          q = `${a} + (${b} √ó ${c}) = ?`; ans=a+(b*c); expl=`Z√°r√≥jel: ${b}√ó${c}=${b*c}, majd √∂sszead√°s: ${a}+${b*c}=${ans}`;
        }
        arr.push({question:q, answer:ans, explanation:expl});
      }
      return arr;
    }
    function generateFractions(difficulty) {
      let arr = [];
      for(let i=0;i<10;i++){
        let type = randInt(1,2);
        let n1=randInt(1,9),d1=randInt(2,10),n2=randInt(1,9),d2=randInt(2,10);
        if(type===1){
          let common=d1*d2,num=n1*d2+n2*d1;
          arr.push({
            question:`${n1}/${d1} + ${n2}/${d2} = ?`,
            answer:simplifyFraction(num,common),
            explanation:`K√∂z√∂s nevez≈ë: ${d1}√ó${d2}=${common}, sz√°ml√°l√≥: ${n1}√ó${d2}+${n2}√ó${d1}=${n1*d2}+${n2*d1}=${num}, egyszer≈±s√≠tve: ${simplifyFraction(num,common)}`
          });
        } else {
          let num=n1*n2,den=d1*d2;
          arr.push({
            question:`${n1}/${d1} √ó ${n2}/${d2} = ?`,
            answer:simplifyFraction(num,den),
            explanation:`Sz√°ml√°l√≥k szorzata: ${n1}√ó${n2}=${num}, nevez≈ëk szorzata: ${d1}√ó${d2}=${den}, egyszer≈±s√≠tve: ${simplifyFraction(num,den)}`
          });
        }
      }
      return arr;
    }
    function generatePercent(difficulty) {
      let arr = [];
      for(let i=0;i<10;i++){
        let base=randInt(10,200),perc=randInt(5,90);
        let askType=randInt(0,1);
        if(askType===0){
          arr.push({
            question:`Mi a ${perc}%-a a ${base}-nak/nek?`,
            answer:Math.round(base*perc/100),
            explanation:`${base} √ó ${perc}% = ${base} √ó ${perc}/100 = ${Math.round(base*perc/100)}`
          });
        } else {
          let value=randInt(1,base);
          arr.push({
            question:`A ${base}-nak h√°ny %-a a ${value}?`,
            answer:Math.round((value/base)*100),
            explanation:`${value} √∑ ${base} √ó 100 = ${Math.round((value/base)*100)}%`
          });
        }
      }
      return arr;
    }
    function generateEquations(difficulty) {
      let arr = [];
      for(let i=0;i<10;i++){
        let x=randInt(-15,20);
        let type=randInt(0,1);
        if(type===0){
          let a=randInt(-10,10),b=x+a;
          arr.push({
            question:`Oldd meg: x + ${a} = ${b}`,
            answer:x,
            explanation:`x = ${b} - (${a}) = ${b-a}`
          });
        } else {
          let k=randInt(2,8),b=x*k;
          arr.push({
            question:`Oldd meg: ${k}x = ${b}`,
            answer:x,
            explanation:`x = ${b} √∑ ${k} = ${b/k}`
          });
        }
      }
      return arr;
    }

    // --- Mapping topic to generator
    function getProblemsByTopicAndDifficulty(topic, difficulty) {
      if (topic==="√ñsszead√°s") return generateAddition(difficulty);
      if (topic==="Kivon√°s") return generateSubtraction(difficulty);
      if (topic==="Szorz√°s") return generateMultiplication(difficulty);
      if (topic==="Oszt√°s") return generateDivision(difficulty);
      if (topic==="Mind a n√©gy m≈±velet") return generateMixed(difficulty);
      if (topic==="Z√°r√≥jeles kifejez√©sek") return generateParentheses(difficulty);
      if (topic==="T√∂rtek") return generateFractions(difficulty);
      if (topic==="Sz√°zal√©ksz√°m√≠t√°s") return generatePercent(difficulty);
      if (topic==="Egyenletek √°trendez√©se") return generateEquations(difficulty);
      return [];
    }

    // --- State ---
    let problems=[], answers=[], score=0, timerInt=null, startTime=0, username="";
    let bestStats={};
    let showSummary=false;

    // --- UI Elements ---
    const $problems = document.getElementById("problems");
    const $category = document.getElementById("category");
    const $difficulty = document.getElementById("difficulty");
    const $username = document.getElementById("username");
    const $score = document.getElementById("score");
    const $timer = document.getElementById("timer");
    const $start = document.getElementById("start-btn");
    const $restart = document.getElementById("restart-btn");
    const $summary = document.getElementById("summary");
    const $best = document.getElementById("best-stats");

    // --- Best results storage and display ---
    function bestKey() {
      return "math-best-"+$category.value+"-"+$difficulty.value+"-"+($username.value.trim()||"anon");
    }
    function loadBest() {
      let b = localStorage.getItem(bestKey());
      bestStats = b ? JSON.parse(b) : {score:0,time:null};
      if(bestStats.score>0) {
        $best.textContent = `üèÜ Legjobb: ${bestStats.score}/10 pont, ${bestStats.time} mp (${($username.value||"anon")})`;
        $best.style.display = "";
      } else {
        $best.style.display = "none";
      }
    }
    function saveBestIfNeeded(score, elapsed) {
      if(score > (bestStats.score||0) || (score === bestStats.score && (bestStats.time === null || elapsed < bestStats.time))) {
        bestStats = {score, time:elapsed};
        localStorage.setItem(bestKey(), JSON.stringify(bestStats));
        loadBest();
      }
    }

    // --- Timer ---
    function startTimer() {
      startTime = Date.now();
      $timer.textContent = "‚è±Ô∏è 0 mp";
      if(timerInt) clearInterval(timerInt);
      timerInt = setInterval(()=>{
        let elapsed = Math.floor((Date.now()-startTime)/1000);
        $timer.textContent = `‚è±Ô∏è ${elapsed} mp`;
      }, 1000);
    }
    function stopTimer() {
      if(timerInt) clearInterval(timerInt);
    }

    // --- Numpad ---
    function renderNumpad(answerState, onChange) {
      const keys = ['1','2','3','4','5','6','7','8','9','-','0','‚Üê'];
      const numpadDiv = document.createElement('div');
      numpadDiv.className = 'numpad';
      keys.forEach(key => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'numpad-btn';
        btn.textContent = key;
        btn.tabIndex = 0;
        btn.onclick = () => {
          if (key === '‚Üê') {
            answerState.value = answerState.value.slice(0, -1);
          } else if (key === '-') {
            if (!answerState.value.startsWith('-')) answerState.value = '-' + answerState.value;
            else answerState.value = answerState.value.substring(1);
          } else {
            answerState.value += key;
          }
          onChange(answerState.value);
        };
        numpadDiv.appendChild(btn);
      });
      return numpadDiv;
    }

    // --- Problem rendering and interaction ---
    function renderProblems() {
      $problems.innerHTML = "";
      answers = Array(problems.length).fill("");
      score = 0;
      $score.textContent = "üèÖ 0";
      problems.forEach((p, i) => {
        const card = document.createElement("div");
        card.className = "problem-card";
        // Question
        const label = document.createElement("label");
        label.className = "problem-label";
        label.textContent = `${i+1}. ${p.question}`;
        card.appendChild(label);
        // "Virtu√°lis input"
        let answerState = {value:""};
        const answerView = document.createElement("div");
        answerView.className = "answer-view";
        answerView.textContent = "";
        card.appendChild(answerView);
        // Numpad
        card.appendChild(renderNumpad(answerState, val => { answerView.textContent = val; }));
        // Feedback
        const feedback = document.createElement("div");
        feedback.className = "feedback";
        card.appendChild(feedback);
        // Ellen≈ërz≈ë/k√ºld√©s gomb
        const checkBtn = document.createElement("button");
        checkBtn.type = "button";
        checkBtn.textContent = "Ellen≈ërz√©s";
        checkBtn.className = "numpad-btn";
        checkBtn.onclick = ()=>{
          if (answerState.value === "" || answerState.value === "-") {
            feedback.textContent = "√çrj be v√°laszt!";
            feedback.className = "feedback wrong";
            return;
          }
          let correct = false;
          // T√∂rtek, lehets√©ges t√∂bbf√©le form√°tum
          if ($category.value==="T√∂rtek") {
            const normalize = s => s.replace(/\s/g,"").replace(/^-0+/, "-").replace(/^0+/, "");
            correct = normalize(answerState.value) === normalize(p.answer);
          } else {
            correct = (parseFloat(answerState.value.replace(",", ".")) == p.answer);
          }
          if (correct) {
            feedback.textContent = "‚úÖ Helyes!";
            feedback.className = "feedback correct";
            answers[i] = "good";
            checkBtn.disabled = true;
            answerView.style.background = "#2d5230";
            score++;
            $score.textContent = `üèÖ ${score}`;
            if (answers.filter(x=>x==="good").length === problems.length) finishPractice();
          } else {
            feedback.textContent = `‚ùå Hib√°s! Helyes: ${p.answer}\n${p.explanation||""}`;
            feedback.className = "feedback wrong";
            answers[i] = "wrong";
            answerView.style.background = "#4c2323";
          }
        };
        card.appendChild(checkBtn);
        $problems.appendChild(card);
      });
    }

    // --- Summary at the end ---
    function finishPractice() {
      stopTimer();
      let elapsed = Math.floor((Date.now()-startTime)/1000);
      $summary.innerHTML =
        `<div class="summary"><h2>Eredm√©ny √∂sszegz√©s</h2>
        <b>Pontsz√°m:</b> ${score}/10<br>
        <b>Id≈ë:</b> ${elapsed} mp
        <ul class="summary-list">
        ${problems.map((p,i)=>answers[i]==="good"
          ? `<li>‚úÖ ${p.question}</li>`
          : `<li>‚ùå ${p.question} <span style="color:#79ec7d;">Helyes: ${p.answer}</span></li>`
        ).join("")}
        </ul>
        </div>`;
      saveBestIfNeeded(score, elapsed);
      $restart.style.display = "";
    }

    // --- Start/restart logic ---
    function startPractice() {
      $summary.innerHTML = "";
      problems = getProblemsByTopicAndDifficulty($category.value, $difficulty.value);
      renderProblems();
      score = 0;
      $score.textContent = "üèÖ 0";
      $start.style.display = "none";
      $restart.style.display = "none";
      $timer.textContent = "‚è±Ô∏è 0 mp";
      startTimer();
      loadBest();
    }
    $start.onclick = startPractice;
    $restart.onclick = startPractice;

    // --- Update best on change ---
    [$category, $difficulty, $username].forEach(el=>{
      el.addEventListener("change", loadBest);
      el.addEventListener("input", loadBest);
    });

    // --- Initial state ---
    loadBest();

  </script>
</body>
</html>
